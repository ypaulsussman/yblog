---
title: GoRails Webpack Notes
date: "2019-06-02"
template: "post"
draft: true
slug: "/posts/gorails-webpack-notes/"
category: "What I Read"
tags:
  - "Ruby"
  - "Rails"
  - "JavaScript"
  - "Webpack"
description: "Notes from GoRails videos."
---


## How to use Javascript via Webpacker in Rails 6 

The `webpacker.yml` file typically needs little configuration.

The `config/webpack` dir contains files for separate environments; it, too, rarely needs much manipulation.

The `package.json` lists, well, all the JS libs your app uses.

`app/javascript/packs/application.js` contains the imports for all your JS libraries and source code (_for webpack to then compile._)

In that file, `require("channels")` is used by ActionCable. 

In earlier versions of the Webpacker gem, `babel.config` and `postcss.config` were `.yml` files; now, they're `.js` files.

It's not clear whether you need to run sth equivalent to the following for _every_ third-party JS library you pull in:

```javascript
import flatpickr from 'flatpickr'

document.addEventListener("turbolinks:load", () => {
    flatpickr("[data-behavior='flatpickr']", {
      dateFormat: 'Y-m-d'
    })  
})
```

Note you'll almost always want to add `<%= stylesheet_pack_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %:>` to your `application.html.erb`, so as to make use of the CSS that Webpack provides (rather than merely that CSS located inside the `app/assets` dir and generated by the asset pipeline.) Its absence won't cause problems in dev, as in that env Webpack serves all its JS and CSS together in a single JS file for `webpack-dev-server` to be able to hot reload easily.


## How to install TailwindCSS 1.0 with Rails 6 

`$ bin/webpack` will get all your JS/CSS to compile, so you can check right after changing webpack settings whether you've broken everything or not. 

Note that you need to import your `app/javascript/stylesheets/application.scss` into `app/javascript/packs/application.js`, via e.g. `require('stylesheets/application.scss')`


## How to use Bootstrap with Webpack & Rails 

Inside your `config/webpack/*.js` env files, include e.g.
```javascript
environment.plugins.append('Provide', new webpack.ProvidePlugin({
  $: 'jquery',
  jQuery: 'jquery'
}))
```
...in order for e.g. Bootstrap to have access to the `jquery` library via those two vars (webpack will now provide them.)

`MissingEntryError` is almost always a case of Webpack being unable to compile successfully; the server log will usually be able to point you to the right place.


## How to Remove Unused CSS Classes with PurgeCSS

Use `postcss` to compile CSS through Webpack.

Within your `.js` files, you can access the current rails environment (as `webpack-dev-server` understands it) via `process.env.RAILS_ENV`.

Note that you can't use string interpolation for classes (e.g. `bg-#{post.state}`, when `post.state` could evaluate to `published` or `draft` strings); PurgeCSS (_reasonably_) won't be able to evaluate your code to check all possible outcomes. 
